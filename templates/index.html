{% extends 'base.html' %}

{% block title %}NoteCart — Вход{% endblock %}

{% block content %}
<div class="auth-grid">
    <div class="auth-card">
        <h2>Вход</h2>
        <form id="loginForm">
            <label>Email</label>
            <input name="email" type="email" placeholder="example@mail.com" required>
            <label>Пароль</label>
            <input name="password" type="password" placeholder="••••••••" required>
            <button class="btn-primary" type="submit">Войти</button>
        </form>
    </div>

    <div class="auth-card">
        <h2>Регистрация</h2>
        <form id="registerForm">
            <label>Имя</label>
            <input name="name" type="text" placeholder="Ваше имя">
            <label>Email</label>
            <input name="email" type="email" placeholder="example@mail.com" required>
            <label>Пароль</label>
            <input name="password" type="password" placeholder="Минимум 8 символов" required>
            <button class="btn-primary" type="submit">Зарегистрироваться</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
<script>
document.getElementById('loginForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const res = await api.post('/auth/login', Object.fromEntries(fd));
    if(res.ok){
        showToast('Вход выполнен');
        setTimeout(()=> location.href='/dashboard', 600);
    } else {
        showToast(res.error || 'Ошибка входа');
    }
});

document.getElementById('registerForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const res = await api.post('/auth/register', Object.fromEntries(fd));
    if(res.ok){
        showToast('Регистрация успешна');
        setTimeout(()=> location.href='/dashboard', 600);
    } else {
        showToast(res.error || JSON.stringify(res.errors) || 'Ошибка регистрации');
    }
});
</script>
{% endblock %}
